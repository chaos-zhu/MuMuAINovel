services:
  ai-story:
    image: docker.cnb.cool/chaoszhu/mumuainovel:latest
    container_name: mumuainovel
    ports:
      - "7888:8000"
    volumes:
      # 持久化数据库和日志
      - ./data:/app/data
      - ./logs:/app/logs
      # 挂载环境变量文件（可选）
      # - ./.env:/app/.env:ro
    environment:
      # 应用配置
      - APP_NAME=AI Story Creator
      - APP_VERSION=1.0.0
      - APP_HOST=0.0.0.0
      - APP_PORT=8000
      - DEBUG=false

      # 重要：环境变量会从 .env 文件自动加载
      # 也可以在这里显式设置，优先级：此处设置 > .env 文件

      # AI服务配置（建议在 .env 文件中设置）
      - OPENAI_API_KEY=your_openai_key_here
      - OPENAI_BASE_URL=https://api.openai.com/v1

        # ===== 本地账户登录配置 =====
      - LOCAL_AUTH_ENABLED=true
      - LOCAL_AUTH_USERNAME=admin
      - LOCAL_AUTH_PASSWORD=your_secure_password_here
      - LOCAL_AUTH_DISPLAY_NAME=管理员

      # ===== CORS 配置（生产环境）=====
      - CORS_ORIGINS=https://your-domain.com
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - ai-story-network

networks:
  ai-story-network:
    driver: bridge
